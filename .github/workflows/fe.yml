# ÄÆ°á»ng dáº«n: .github/workflows/deploy-frontend.yml

name: ğŸš€ Deploy Frontend to SomEE

on:
  push:
    branches:
      - main # Cháº¡y khi code Ä‘Æ°á»£c push lÃªn nhÃ¡nh 'main'
    paths:
      - 'frontend/**' # CHá»ˆ cháº¡y khi cÃ³ thay Ä‘á»•i trong thÆ° má»¥c 'frontend'

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    # Äá»‹nh nghÄ©a biáº¿n mÃ´i trÆ°á»ng cho deployment
    env:
      FE_DIST_PATH: frontend/dist # Giáº£ sá»­ thÆ° má»¥c build ra lÃ  'dist' trong 'frontend'

    steps:
      - name: ğŸ“¦ Checkout code
        uses: actions/checkout@v4

      - name: âš™ï¸ Setup Node.js Environment
        uses: actions/setup-node@v4
        with:
          node-version: '18' # Äiá»u chá»‰nh phiÃªn báº£n Node.js náº¿u cáº§n

      - name: ğŸ§± Install Dependencies & Build Frontend
        run: |
          cd frontend
          npm install
          npm run build # Thay tháº¿ báº±ng lá»‡nh build thá»±c táº¿ cá»§a dá»± Ã¡n báº¡n (vÃ­ dá»¥: yarn build)
        
      - name: ğŸ“¤ Deploy Frontend via SFTP (Sá»­ dá»¥ng Host/User/Pass)
        # Sá»¬ Dá»¤NG: appleboy/scp-action lÃ  má»™t action phá»• biáº¿n Ä‘á»ƒ deploy qua SFTP/SCP.
        # Báº N Cáº¦N THAY THáº¾ náº¿u SomEE cÃ³ action riÃªng HOáº¶C báº¡n dÃ¹ng CLI.
        uses: appleboy/scp-action@v0.1.7 
        with:
          host: ${{ secrets.SOMEE_FE_HOST }}
          username: ${{ secrets.SOMEE_FE_USER }}
          password: ${{ secrets.SOMEE_FE_PASS }}
          port: 22 # Thay tháº¿ báº±ng cá»•ng SFTP/FTP mÃ  SomEE cung cáº¥p (thÆ°á»ng lÃ  22 hoáº·c 21)
          source: ${{ env.FE_DIST_PATH }}/* # Triá»ƒn khai táº¥t cáº£ file trong thÆ° má»¥c build
          # THAY THáº¾ 'target' báº±ng Ä‘Æ°á»ng dáº«n thÆ° má»¥c cÃ´ng khai (wwwroot) trÃªn server SomEE cá»§a báº¡n
          target: "/site/wwwroot/frontend-app" 
          strip_components: 1 # Äá»ƒ chá»‰ upload ná»™i dung bÃªn trong thÆ° má»¥c 'dist'
          
      - name: âœ… Deployment Successful
        run: echo "Frontend Ä‘Ã£ Ä‘Æ°á»£c triá»ƒn khai thÃ nh cÃ´ng lÃªn SomEE!"
